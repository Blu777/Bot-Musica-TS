version: '3.8'

services:
  # TS3AudioBot - Maneja la transmisi칩n de audio real a TeamSpeak
  ts3audiobot:
    image: splamy/ts3audiobot:develop
    container_name: ts3audiobot
    restart: unless-stopped
    volumes:
      - ./ts3audiobot-config:/app/config
      - ./downloads:/app/music
      - ./ts3audiobot-data:/app/data
    ports:
      - "58913:58913"  # API Web para control externo
    environment:
      # Configuraci칩n b치sica (se puede override con archivo config)
      - TS3AUDIOBOT_CONNECT__ADDRESS=${TS3_HOST}
      - TS3AUDIOBOT_CONNECT__CHANNEL=${TS3_CHANNEL:-Music}
      - TS3AUDIOBOT_CONNECT__BADGES=overwolf=0:badges=
      - TS3AUDIOBOT_BOT__NAME=${BOT_NICKNAME:-MusicBot}
      - TS3AUDIOBOT_AUDIO__BITRATE=128
      - TS3AUDIOBOT_WEBAPI__ENABLED=true
      - TS3AUDIOBOT_WEBAPI__PORT=58913
    networks:
      - ts3-network

  # Bot Python - Maneja comandos y l칩gica de negocio
  music-bot-controller:
    build: .
    container_name: music-bot-controller
    restart: unless-stopped
    depends_on:
      - ts3audiobot
    environment:
      - TS3_HOST=${TS3_HOST}
      - TS3_PORT=${TS3_PORT:-10011}
      - TS3_USER=${TS3_USER}
      - TS3_PASSWORD=${TS3_PASSWORD}
      - TS3_SERVER_ID=${TS3_SERVER_ID:-1}
      - TS3_CHANNEL_ID=${TS3_CHANNEL_ID:-1}
      - BOT_NICKNAME=${BOT_NICKNAME:-MusicBot}
      - TS3AUDIOBOT_API=http://ts3audiobot:58913
      - TS3AUDIOBOT_API_KEY=${TS3AUDIOBOT_API_KEY:-}
    volumes:
      - ./downloads:/app/downloads
      - ./cache:/app/cache
    networks:
      - ts3-network

networks:
  ts3-network:
    driver: bridge

volumes:
  ts3audiobot-config:
  ts3audiobot-data:
